(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{492:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var a=r(95155),s=r(12115),o=r(59434);let l=s.forwardRef((e,t)=>{let{className:r,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});l.displayName="Input"},6991:(e,t,r)=>{Promise.resolve().then(r.bind(r,80148))},7004:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(95155),s=r(12115);let o=e=>{let{direction:t="right",speed:r=1,borderColor:o="#999",squareSize:l=40,hoverFillColor:i="#222",mode:n="light"}=e,c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(0),m=(0,s.useRef)(0),h=(0,s.useRef)({x:0,y:0}),g=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=c.current;if(!e)return;let a=e.getContext("2d"),s=()=>{e.width=e.offsetWidth,e.height=e.offsetHeight,u.current=Math.ceil(e.width/l)+1,m.current=Math.ceil(e.height/l)+1};window.addEventListener("resize",s),s();let f=()=>{if(!a)return;a.clearRect(0,0,e.width,e.height);let t=Math.floor(h.current.x/l)*l,r=Math.floor(h.current.y/l)*l;for(let s=t;s<e.width+l;s+=l)for(let n=r;n<e.height+l;n+=l){let e=s-h.current.x%l,c=n-h.current.y%l;g.current&&Math.floor((s-t)/l)===g.current.x&&Math.floor((n-r)/l)===g.current.y&&(a.fillStyle=i,a.fillRect(e,c,l,l)),a.strokeStyle=o,a.strokeRect(e,c,l,l)}let s=a.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,Math.sqrt(e.width**2+e.height**2)/2);"light"===n?(s.addColorStop(0,"rgba(255, 255, 255, 0)"),s.addColorStop(1,"rgba(240, 245, 255, 0.3)")):(s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(1,"#060010")),a.fillStyle=s,a.fillRect(0,0,e.width,e.height)},p=()=>{let e=Math.max(r,.1);switch(t){case"right":h.current.x=(h.current.x-e+l)%l;break;case"left":h.current.x=(h.current.x+e+l)%l;break;case"up":h.current.y=(h.current.y+e+l)%l;break;case"down":h.current.y=(h.current.y-e+l)%l;break;case"diagonal":h.current.x=(h.current.x-e+l)%l,h.current.y=(h.current.y-e+l)%l}f(),d.current=requestAnimationFrame(p)},b=t=>{let r=e.getBoundingClientRect(),a=t.clientX-r.left,s=t.clientY-r.top,o=Math.floor(h.current.x/l)*l,i=Math.floor(h.current.y/l)*l,n=Math.floor((a+h.current.x-o)/l),c=Math.floor((s+h.current.y-i)/l);g.current&&g.current.x===n&&g.current.y===c||(g.current={x:n,y:c})},v=()=>{g.current=null};return e.addEventListener("mousemove",b),e.addEventListener("mouseleave",v),d.current=requestAnimationFrame(p),()=>{window.removeEventListener("resize",s),d.current&&cancelAnimationFrame(d.current),e.removeEventListener("mousemove",b),e.removeEventListener("mouseleave",v)}},[t,r,o,i,l,n]),(0,a.jsx)("canvas",{ref:c,className:"w-full h-full border-none block"})}},25930:(e,t,r)=>{"use strict";r.d(t,{J:()=>c});var a=r(95155),s=r(12115),o=r(40968),l=r(74466),i=r(59434);let n=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(o.b,{ref:t,className:(0,i.cn)(n(),r),...s})});c.displayName=o.b.displayName},40968:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var a=r(12115),s=r(63655),o=r(95155),l=a.forwardRef((e,t)=>(0,o.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=l},59434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var a=r(52596),s=r(39688);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},63655:(e,t,r)=>{"use strict";r.d(t,{hO:()=>n,sG:()=>i});var a=r(12115),s=r(47650),o=r(99708),l=r(95155),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=a.forwardRef((e,r)=>{let{asChild:a,...s}=e,i=a?o.DX:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(i,{...s,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function n(e,t){e&&s.flushSync(()=>e.dispatchEvent(t))}},78496:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(95155),s=r(12115),o=r(99708),l=r(74466),i=r(59434);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,asChild:c=!1,...d}=e,u=c?o.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(n({variant:s,size:l,className:r})),ref:t,...d})});c.displayName="Button"},80148:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(95155),s=r(12115),o=r(6874),l=r.n(o),i=r(66766),n=r(78496),c=r(492),d=r(25930),u=r(95108),m=r(7004),h=r(16961),g=r(16925);let f=()=>{let[e,t]=(0,s.useState)(!1),[r,o]=(0,s.useState)(""),[f,p]=(0,s.useState)(""),[b,v]=(0,s.useState)(!0),[x,y]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),[j,S]=(0,s.useState)(""),[k,P]=(0,s.useState)(""),[I,C]=(0,s.useState)(!1),[_,R]=(0,s.useState)(!1),[T,E]=(0,s.useState)(""),[D,F]=(0,s.useState)(""),[O,A]=(0,s.useState)({firstName:"",lastName:"",email:"",name:"",address:""}),X=()=>(0,a.jsx)("div",{className:"absolute inset-0 z-0",children:(0,a.jsx)(m.A,{speed:.4,squareSize:50,direction:"right",borderColor:"rgba(30, 198, 255, 0.15)",hoverFillColor:"rgba(30, 198, 255, 0.05)",mode:"light"})}),M=e=>{var t,r,a,s,o;let l=null==(t=e.name)?void 0:t.trim(),i=(null==(r=e.email)?void 0:r.trim())||(null==(s=e.user)||null==(a=s.email)?void 0:a.trim());return console.log("Profile completeness check:",{name:e.name,email:e.email,userEmail:null==(o=e.user)?void 0:o.email,isComplete:l&&i}),l&&i},q=(e,t)=>{console.log("\uD83D\uDCE6 Storing auth data...",{tokens:e,userIdFromApi:t}),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("userId"),localStorage.setItem("access_token",e.access),localStorage.setItem("refresh_token",e.refresh),localStorage.setItem("userId",t),E(e.access),F(t),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("loginStatusChanged")),console.log("✅ Auth data stored successfully"),console.log("Stored tokens:",{access:localStorage.getItem("access_token"),refresh:localStorage.getItem("refresh_token"),userId:localStorage.getItem("userId")})},L=e=>{var t,r,a,s;console.log("\uD83D\uDCE6 Storing profile data:",e),localStorage.setItem("customerId",(null==(t=e.id)?void 0:t.toString())||""),localStorage.setItem("firstName",(null==(r=e.user)?void 0:r.first_name)||""),localStorage.setItem("lastName",(null==(a=e.user)?void 0:a.last_name)||""),localStorage.setItem("displayName",e.name||""),localStorage.setItem("email",e.email||(null==(s=e.user)?void 0:s.email)||""),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new CustomEvent("loginStatusChanged")),console.log("✅ Profile data stored and events triggered"),console.log("Stored profile:",{customerId:localStorage.getItem("customerId"),firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),displayName:localStorage.getItem("displayName"),email:localStorage.getItem("email")})};(0,s.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("access_token"),s=localStorage.getItem("userId");if(console.log("\uD83D\uDD0D Checking existing auth:",{hasToken:!!a,hasId:!!s}),!a||!s){console.log("❌ No auth data found"),y(!1),v(!1);return}E(a),F(s),console.log("\uD83D\uDD04 Fetching profile for user ID: ".concat(s));let o=await fetch("https://api.grayscale-technologies.com/api/v1/customers/".concat(s,"/"),{headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"}});if(o.ok){var e,t,r;let a=await o.json();if(console.log("✅ Profile data received:",a),M(a)){console.log("✅ Profile complete, redirecting to CustomerDashboard"),L(a),w(!0),setTimeout(()=>{window.location.href="/CustomerDashboard"},500);return}console.log("\uD83D\uDCDD Profile incomplete, showing form"),A({firstName:(null==(e=a.user)?void 0:e.first_name)||"",lastName:(null==(t=a.user)?void 0:t.last_name)||"",email:a.email||(null==(r=a.user)?void 0:r.email)||"",name:a.name||"",address:a.address||""}),S(a.phone_number||"")}else if(401===o.status){console.log("❌ Token invalid (401), clearing auth data"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("userId"),y(!1),v(!1);return}y(!0)}catch(e){console.error("❌ Auth check error:",e),y(!1)}finally{v(!1)}})()},[]);let z=e=>{let{name:t,value:r}=e.target;A(e=>({...e,[t]:r}))},J=async()=>{if(!j.trim())return void o("Please enter a phone number");if(!/^01[3-9]\d{8}$/.test(j.replace(/\s/g,"")))return void o("Please enter a valid Bangladesh phone number (01XXXXXXXXX)");R(!0),o(""),p("");try{console.log("\uD83D\uDCF1 Requesting OTP for:",j);let e=await fetch("https://api.grayscale-technologies.com/api/auth/request-otp/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:j.trim()})}),t=await e.json();console.log("\uD83D\uDCF1 OTP request response:",t),e.ok?(C(!0),p("OTP sent successfully! Please check your phone.")):o(t.message||t.detail||"Failed to send OTP. Please try again.")}catch(e){console.error("❌ OTP request error:",e),o("Network error. Please try again.")}finally{R(!1)}},$=async()=>{if(!k.trim())return void o("Please enter the OTP");t(!0),o(""),p("");try{console.log("\uD83D\uDD10 Verifying OTP...");let t=await fetch("https://api.grayscale-technologies.com/api/auth/verify-otp/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:j.trim(),otp:k.trim()})}),s=await t.json();if(console.log("\uD83D\uDD10 OTP verification response:",s),t.ok){console.log("✅ OTP verified successfully");let{access:t,refresh:l,id:i}=s;if(!t||!l||!i){console.error("❌ Missing auth data in response:",s),o("Authentication failed. Missing required data.");return}q({access:t,refresh:l},i.toString()),await new Promise(e=>setTimeout(e,100)),console.log("\uD83D\uDD04 Checking profile for customer ID: ".concat(i));let n=await fetch("https://api.grayscale-technologies.com/api/v1/customers/".concat(i,"/"),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(n.ok){var e,r,a;let t=await n.json();if(console.log("✅ Profile data received:",t),M(t)){console.log("✅ Profile complete - logging in user"),L(t),p("Login successful! Redirecting to dashboard..."),w(!0),setTimeout(()=>{console.log("\uD83D\uDD04 Redirecting to CustomerDashboard..."),console.log("Final auth check before redirect:",{access_token:localStorage.getItem("access_token"),userId:localStorage.getItem("userId"),displayName:localStorage.getItem("displayName")}),window.location.replace("/CustomerDashboard")},2e3);return}console.log("\uD83D\uDCDD Profile incomplete - showing registration form"),A({firstName:(null==(e=t.user)?void 0:e.first_name)||"",lastName:(null==(r=t.user)?void 0:r.last_name)||"",email:t.email||(null==(a=t.user)?void 0:a.email)||"",name:t.name||"",address:t.address||""}),y(!0),p("Phone verified! Please complete your profile.")}else 404===n.status?console.log("\uD83D\uDCDD No profile found - showing registration form"):console.log("⚠️ Profile check failed - showing registration form"),y(!0),p("Phone verified! Please complete your registration.")}else o(s.message||s.detail||"Invalid OTP. Please try again.")}catch(e){console.error("❌ OTP verification error:",e),o("Network error. Please try again.")}finally{t(!1)}},B=(e,t,r)=>{let a=Date.now(),s=r.slice(-4);return"".concat(e.toLowerCase(),"_").concat(t.toLowerCase(),"_").concat(s,"_").concat(a)},V=async e=>{if(e.preventDefault(),o(""),p(""),!O.firstName||!O.lastName||!O.email||!O.name)return void o("Please fill in all required fields");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(O.email))return void o("Please enter a valid email address");t(!0);try{console.log("\uD83D\uDD04 Submitting registration...");let e={user:{username:B(O.firstName,O.lastName,j),email:O.email,first_name:O.firstName,last_name:O.lastName},name:O.name,phone_number:j,email:O.email,address:O.address||""};console.log("\uD83D\uDCE4 Registration payload:",e);let t=await fetch("https://api.grayscale-technologies.com/api/v1/customers/".concat(D,"/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(T)},body:JSON.stringify(e)}),r=await t.json();console.log("\uD83D\uDCE5 Registration response:",r),t.ok?(console.log("✅ Registration successful"),L(r),p("Account created successfully! Redirecting to dashboard..."),w(!0),setTimeout(()=>{console.log("\uD83D\uDD04 Redirecting to CustomerDashboard after registration..."),console.log("Final auth check before redirect:",{access_token:localStorage.getItem("access_token"),userId:localStorage.getItem("userId"),displayName:localStorage.getItem("displayName")}),window.location.replace("/CustomerDashboard")},2500)):o(r.message||r.detail||"Registration failed. Please try again.")}catch(e){console.error("❌ Registration error:",e),o("Network error. Please try again.")}finally{t(!1)}};return b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.default,{}),(0,a.jsxs)("div",{className:"min-h-screen relative flex items-center justify-center p-4",children:[(0,a.jsx)(X,{}),(0,a.jsx)("div",{className:"absolute inset-0 bg-blue-50 bg-opacity-40"}),(0,a.jsxs)("div",{className:"relative z-10 text-center bg-white rounded-xl p-8 shadow-lg",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Checking authentication..."})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.default,{}),N&&(0,a.jsx)(g.A,{fullScreen:!0,message:"Redirecting to dashboard..."}),(0,a.jsxs)("div",{className:"min-h-screen relative flex items-center justify-center p-4 py-8",children:[(0,a.jsx)(X,{}),(0,a.jsx)("div",{className:"absolute inset-0 bg-blue-50 bg-opacity-30"}),(0,a.jsx)("div",{className:"relative z-10 max-w-md w-full bg-white rounded-2xl shadow-2xl border border-blue-100 my-8",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("div",{className:"text-center flex justify-center",children:(0,a.jsx)(l(),{href:"/",className:"inline-block",children:(0,a.jsx)(i.default,{src:"/mira-ai.png",alt:"Mira AI Logo",width:150,height:12})})}),(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:x?"Complete Your Profile":"Customer Authentication"}),(0,a.jsx)("p",{className:"text-gray-600",children:x?"Please fill in your details to complete registration":"Verify your phone number to continue"})]}),f&&(0,a.jsx)(u.A,{message:"Success",description:f,type:"success",showIcon:!0,className:"mb-4"}),r&&(0,a.jsx)(u.A,{message:"Error",description:r,type:"error",showIcon:!0,className:"mb-4"}),!x&&(0,a.jsx)("div",{className:"space-y-6",children:I?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"phone",children:"Phone Number"}),(0,a.jsx)(c.p,{id:"phone",value:j,disabled:!0,className:"mt-1 bg-gray-50"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"otp",children:"Enter OTP *"}),(0,a.jsx)(c.p,{id:"otp",type:"text",value:k,onChange:e=>{P(e.target.value)},placeholder:"Enter 4-digit OTP",maxLength:4,className:"mt-1 border-blue-200 focus:border-blue-500 focus:ring-blue-500",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Check your SMS for the verification code"})]}),(0,a.jsx)(n.$,{type:"button",onClick:$,disabled:e||!k.trim(),className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium py-3",children:e?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):"Verify & Continue"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>{C(!1),P(""),S(""),o(""),p("")},className:"text-sm text-blue-600 hover:text-blue-700 transition-colors",children:"← Change phone number"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"phone",children:"Phone Number *"}),(0,a.jsx)(c.p,{id:"phone",name:"phone",type:"tel",value:j,onChange:e=>{S(e.target.value)},placeholder:"01XXXXXXXXX",className:"mt-1 border-blue-200 focus:border-blue-500 focus:ring-blue-500",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your Bangladesh mobile number"})]}),(0,a.jsx)(n.$,{type:"button",onClick:J,disabled:_||!j.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium py-3",children:_?"Sending OTP...":"Send OTP"})]})}),x&&(0,a.jsxs)("form",{onSubmit:V,className:"space-y-5",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"firstName",className:"text-sm",children:"First Name *"}),(0,a.jsx)(c.p,{id:"firstName",name:"firstName",value:O.firstName,onChange:z,placeholder:"First name",className:"mt-1 h-9 border-blue-200 focus:border-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"lastName",className:"text-sm",children:"Last Name *"}),(0,a.jsx)(c.p,{id:"lastName",name:"lastName",value:O.lastName,onChange:z,placeholder:"Last name",className:"mt-1 h-9 border-blue-200 focus:border-blue-500",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"name",className:"text-sm",children:"Display Name *"}),(0,a.jsx)(c.p,{id:"name",name:"name",value:O.name,onChange:z,placeholder:"How should we call you?",className:"mt-1 h-9 border-blue-200 focus:border-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"email",className:"text-sm",children:"Email Address *"}),(0,a.jsx)(c.p,{id:"email",name:"email",type:"email",value:O.email,onChange:z,className:"mt-1 h-9 border-blue-200 focus:border-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{htmlFor:"address",className:"text-sm",children:"Address (Optional)"}),(0,a.jsx)(c.p,{id:"address",name:"address",value:O.address,onChange:z,placeholder:"Enter your address",className:"mt-1 h-9 border-blue-200 focus:border-blue-500"})]}),(0,a.jsx)(n.$,{type:"submit",disabled:e,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium py-3 mt-6",children:e?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating Account..."]}):"Complete Registration"})]})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[66,448,766,808,485,352,108,961,441,684,358],()=>t(6991)),_N_E=e.O()}]);