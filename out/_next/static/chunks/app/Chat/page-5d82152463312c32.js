(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{68371:(e,t,n)=>{Promise.resolve().then(n.bind(n,90224))},90224:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>et});var s=n(15933),r=n(95155),o=n(37480),a=n(44724),i=n(47739),l=n(9622),c=n(21073),d=n(46996),u=n(79659),p=n(56170),g=n(39213),f=n(70129),h=n(16253),m=n(31601),x=n(63066),y=n(11168),v=n(85398),b=n(37488),j=n(50626),A=n(48171),k=n(8362),w=n(16428),S=n(98696),I=n(75032),_=n(16467),N=n(97226),z=n(17238),C=n(14743),E=n(30832),R=n.n(E),T=n(12115),P=n(66766),M=n(90792),B=n(16961);function O(){let e=(0,s._)(["\n      width: 100%;\n      height: calc(100vh - 64px);\n      display: flex;\n      background: ",";\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    "]);return O=function(){return e},e}function W(){let e=(0,s._)(["\n      background: ",";\n      width: 280px;\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n      padding: 0 12px;\n      box-sizing: border-box;\n      border-right: 1px solid ",";\n    "]);return W=function(){return e},e}function q(){let e=(0,s._)(["\n      display: flex;\n      align-items: center;\n      justify-content: start;\n      padding: 0 14px;\n      box-sizing: border-box;\n      gap: 8px;\n      margin: 14px 0;\n      font-size: 16px;\n      font-weight: bold;\n\n      span {\n        font-weight: bold;\n        color: ",";\n        font-size: 36px;\n      }\n    "]);return q=function(){return e},e}function H(){let e=(0,s._)(["\n      background: #1677ff0f;\n      border: 1px solid #1677ff34;\n      height: 40px;\n    "]);return H=function(){return e},e}function L(){let e=(0,s._)(["\n      flex: 1;\n      overflow-y: auto;\n      margin-top: 12px;\n      padding: 0;\n\n      .ant-conversations-list {\n        padding-inline-start: 0;\n      }\n    "]);return L=function(){return e},e}function F(){let e=(0,s._)(["\n      border-top: 1px solid ",";\n      height: 60px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 0 12px;\n    "]);return F=function(){return e},e}function U(){let e=(0,s._)(["\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      flex: 1;\n      min-width: 0;\n\n      .user-name {\n        font-weight: 500;\n        font-size: 14px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n    "]);return U=function(){return e},e}function J(){let e=(0,s._)(["\n      height: 100%;\n      width: 100%;\n      box-sizing: border-box;\n      display: flex;\n      flex-direction: column;\n      padding-block: ","px;\n      gap: 16px;\n      background: linear-gradient(to bottom, #f0f7ff, #ffffff);\n    "]);return J=function(){return e},e}function D(){let e=(0,s._)(["\n      .ant-prompts-label {\n        color: #000000e0 !important;\n      }\n      .ant-prompts-desc {\n        color: #000000a6 !important;\n        width: 100%;\n      }\n      .ant-prompts-icon {\n        color: #000000a6 !important;\n      }\n    "]);return D=function(){return e},e}function G(){let e=(0,s._)(["\n      flex: 1;\n      overflow: auto;\n    "]);return G=function(){return e},e}function K(){let e=(0,s._)(["\n      position: relative;\n      overflow: hidden;\n\n      &::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: linear-gradient(90deg, #1677ff 0%, #69c0ff 50%, #1677ff 100%);\n        background-size: 200% 100%;\n        animation: shimmer 2s infinite;\n      }\n\n      @keyframes shimmer {\n        0% {\n          background-position: -200% 0;\n        }\n        100% {\n          background-position: 200% 0;\n        }\n      }\n    "]);return K=function(){return e},e}function Y(){let e=(0,s._)(["\n      padding-top: 32px;\n    "]);return Y=function(){return e},e}function Q(){let e=(0,s._)(["\n      width: 100%;\n      max-width: 700px;\n      margin: 0 auto;\n    "]);return Q=function(){return e},e}function V(){let e=(0,s._)(["\n      font-size: 18px;\n      color: "," !important;\n    "]);return V=function(){return e},e}function X(){let e=(0,s._)(["\n      width: 100%;\n      max-width: 700px;\n      margin: 0 auto;\n      color: ",";\n    "]);return X=function(){return e},e}let Z=[{key:"default-0",label:"Shopping Assistant",group:"Today"}];o.A,a.A,i.A,l.A;let $=[{key:"1",description:"Show me products",icon:(0,r.jsx)(o.A,{})},{key:"2",description:"Help me order",icon:(0,r.jsx)(c.A,{})},{key:"3",description:"Payment support",icon:(0,r.jsx)(l.A,{})}],ee=(0,C.rU)(e=>{let{token:t,css:n}=e;return{layout:n(O(),t.colorBgContainer),sider:n(W(),t.colorBgLayout,t.colorBorderSecondary),logo:n(q(),t.colorText),addBtn:n(H()),conversations:n(L()),siderFooter:n(F(),t.colorBorderSecondary),userInfo:n(U()),chat:n(J(),t.paddingLG),chatPrompt:n(D()),chatList:n(G()),loadingMessage:n(K()),placeholder:n(Y()),sender:n(Q()),speechButton:n(V(),t.colorText),senderPrompt:n(X(),t.colorText)}}),et=()=>{let{styles:e}=ee(),t=(0,T.useRef)(null),[n,s]=(0,T.useState)({}),[o,a]=(0,T.useState)(Z),[i,l]=(0,T.useState)(Z[0].key),[c,C]=(0,T.useState)(""),[E,O]=(0,T.useState)(!1),[W,q]=(0,T.useState)("Guest"),[H]=(0,T.useState)(()=>{{let e=localStorage.getItem("chat_session_id");if(e)return e;let t=crypto.randomUUID();return localStorage.setItem("chat_session_id",t),t}}),[L,F]=(0,T.useState)(!1);(0,T.useEffect)(()=>{let e=localStorage.getItem("access_token"),t=localStorage.getItem("displayName"),n=localStorage.getItem("firstName");O(!!e),t?q(t):n&&q(n)},[]);let U=parseInt("1"),[J]=(0,x.A)({request:async(e,t)=>{let{message:n,messages:s}=e,{onUpdate:r}=t;try{var o;F(!0);let e=localStorage.getItem("access_token"),t=[...(s||[]).filter(e=>(null==e?void 0:e.content)&&e.content.trim()).map(e=>({role:"user"===e.role?"user":"assistant",content:e.content})),{role:"user",content:(null==n?void 0:n.content)||""}],a={"Content-Type":"application/json"};E&&e?a.Authorization="Bearer ".concat(e):a.Authorization="Client-Key ".concat("15f1d1cb-b6a0-4133-9f5a-643a3affe291");let i=await fetch("".concat("https://mira-chat.grayscale-technologies.com","/chat"),{method:"POST",headers:a,body:JSON.stringify({session_id:H,company_id:U,messages:t})});if(!i.ok){let e=await i.text();throw console.error("API Error Response:",e),Error("API Error: ".concat(i.status," ").concat(i.statusText))}let l=null==(o=i.body)?void 0:o.getReader(),c=new TextDecoder,d="",u="",p=[];if(l){for(;;){let{done:e,value:t}=await l.read();if(e)break;let n=c.decode(t,{stream:!0}),s=(u+=n).split("\n");for(let e of(u=s.pop()||"",s))if(e.startsWith("data: "))try{let t=e.substring(6),n=JSON.parse(t);"text"===n.type&&n.data&&p.push(n.data)}catch(e){console.error("Error parsing chunk:",e)}}if(u.trim()&&u.startsWith("data: "))try{let e=u.substring(6),t=JSON.parse(e);"text"===t.type&&t.data&&p.push(t.data)}catch(e){console.error("Error parsing final chunk:",e)}let e=p.join("");for(let t=0;t<e.length;t+=5)d=e.slice(0,Math.min(t+5,e.length)),r({content:d,role:"assistant"}),t+5<e.length&&await new Promise(e=>setTimeout(e,50));d=e}let g=d||"No response received";return console.log("Request completed, setting isStreaming to false"),F(!1),{content:g,role:"assistant"}}catch(e){throw console.error("Chat error:",e),F(!1),e}}}),{onRequest:D,messages:G,setMessages:K}=(0,y.A)({agent:J,requestFallback:(e,t)=>{let{error:n}=t;return"AbortError"===n.name?{content:"Request cancelled",role:"assistant"}:{content:"Sorry, I encountered an error. Please try again.",role:"assistant"}}});(0,T.useEffect)(()=>{n[i]&&n[i].length>0?K(n[i]):0===G.length&&K([{message:{content:"Hello".concat(E?" "+W:"","! I'm MIRA, your AI shopping assistant. I can help you find products, place orders, and answer any questions you have. What would you like to do today?"),role:"assistant"},id:"welcome",status:"success"}])},[i]);let Y=e=>{if(null==e?void 0:e.trim()){if(L)return void w.Ay.error("Please wait for the current response to complete.");D({message:{role:"user",content:e}})}},Q=(0,r.jsxs)("div",{className:e.sider,children:[(0,r.jsx)("div",{className:e.logo,children:"Manage Conversations"}),(0,r.jsx)(S.Ay,{onClick:()=>{if(J.isRequesting())return void w.Ay.error("Please wait for the current message to complete.");let e=R()().valueOf().toString();a([{key:e,label:"Chat ".concat(o.length+1),group:"Today"},...o]),l(e),K([{message:{content:"Hello".concat(E?" "+W:"","! I'm MIRA, your AI shopping assistant. How can I help you today?"),role:"assistant"},id:"welcome-"+e,status:"success"}])},type:"link",className:e.addBtn,icon:(0,r.jsx)(d.A,{}),children:"New Chat"}),(0,r.jsx)(v.A,{items:o,className:e.conversations,activeKey:i,onActiveChange:async e=>{var s;null==(s=t.current)||s.abort(),setTimeout(()=>{l(e),K((null==n?void 0:n[e])||[])},100)},groupable:!0,styles:{item:{padding:"0 8px"}},menu:e=>({items:[{label:"Rename",key:"rename",icon:(0,r.jsx)(u.A,{})},{label:"Delete",key:"delete",icon:(0,r.jsx)(p.A,{}),danger:!0,onClick:()=>{var t;let s=o.filter(t=>t.key!==e.key),r=null==s||null==(t=s[0])?void 0:t.key;a(s),setTimeout(()=>{e.key===i&&(l(r),K((null==n?void 0:n[r])||[]))},200)}}]})}),(0,r.jsxs)("div",{className:e.siderFooter,children:[(0,r.jsxs)("div",{className:e.userInfo,children:[(0,r.jsx)(I.A,{size:32,style:{backgroundColor:"#1677ff"},children:W.charAt(0).toUpperCase()}),(0,r.jsx)("span",{className:"user-name",children:W})]}),(0,r.jsx)(S.Ay,{type:"text",icon:(0,r.jsx)(g.A,{}),href:"/"})]})]}),V=(0,r.jsx)("div",{className:e.chatList,children:(null==G?void 0:G.length)>0?(0,r.jsx)(b.A.List,{items:null==G?void 0:G.map(t=>{var n,s,r;return{role:(null==(n=t.message)?void 0:n.role)||"assistant",content:(null==(s=t.message)?void 0:s.content)||"",key:t.id,classNames:{content:"loading"===t.status?e.loadingMessage:""},typing:(null==(r=t.message)?void 0:r.role)==="assistant"&&"loading"===t.status&&{step:3,interval:20},variant:"shadow"}}),style:{height:"100%",paddingInline:"calc((100% - 700px) / 2)"},roles:{assistant:{placement:"start",avatar:{src:"/mira-ai.png",style:{background:"transparent"}},typing:{step:3,interval:20},messageRender:e=>(0,r.jsx)(M.oz,{components:{p:e=>{let{children:t}=e;return(0,r.jsx)("p",{style:{margin:"0.5em 0"},children:t})},strong:e=>{let{children:t}=e;return(0,r.jsx)("strong",{style:{fontWeight:600,color:"#000"},children:t})},ul:e=>{let{children:t}=e;return(0,r.jsx)("ul",{style:{margin:"0.5em 0",paddingLeft:"1.5em"},children:t})},ol:e=>{let{children:t}=e;return(0,r.jsx)("ol",{style:{margin:"0.5em 0",paddingLeft:"1.5em"},children:t})},li:e=>{let{children:t}=e;return(0,r.jsx)("li",{style:{margin:"0.25em 0"},children:t})},h1:e=>{let{children:t}=e;return(0,r.jsx)("h1",{style:{fontSize:"1.5em",fontWeight:600,margin:"0.5em 0"},children:t})},h2:e=>{let{children:t}=e;return(0,r.jsx)("h2",{style:{fontSize:"1.3em",fontWeight:600,margin:"0.5em 0"},children:t})},h3:e=>{let{children:t}=e;return(0,r.jsx)("h3",{style:{fontSize:"1.1em",fontWeight:600,margin:"0.5em 0"},children:t})}},children:String(e)}),styles:{content:{background:"#f7f7f8",lineHeight:"1.6"}},footer:(0,r.jsxs)("div",{style:{display:"flex",gap:"4px",marginTop:"8px"},children:[(0,r.jsx)(S.Ay,{type:"text",size:"small",icon:(0,r.jsx)(f.A,{})}),(0,r.jsx)(S.Ay,{type:"text",size:"small",icon:(0,r.jsx)(h.A,{})}),(0,r.jsx)(S.Ay,{type:"text",size:"small",icon:(0,r.jsx)(m.A,{})})]}),loadingRender:()=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsx)(_.A,{size:"small"}),(0,r.jsx)("span",{style:{color:"#999"},children:"MIRA is thinking..."})]})},user:{placement:"end",avatar:{children:W.charAt(0).toUpperCase(),style:{backgroundColor:"#1677ff"}},styles:{content:{background:"#1677ff",color:"#ffffff",whiteSpace:"pre-wrap",lineHeight:"1.6"}}}}}):(0,r.jsx)(N.A,{direction:"vertical",size:16,style:{paddingInline:"calc((100% - 700px) / 2)"},className:e.placeholder,children:(0,r.jsx)(j.A,{variant:"borderless",icon:(0,r.jsx)(P.default,{src:"/mira-ai.png",alt:"MIRA AI",width:100,height:100}),title:"Welcome to MIRA AI",description:"Your intelligent shopping assistant. I can help you browse products, place orders, track shipments, and answer any questions about your purchases."})})}),X=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.A,{items:$,onItemClick:e=>{Y(e.data.description)},styles:{item:{padding:"6px 12px"}},className:e.senderPrompt}),(0,r.jsx)(k.A,{value:c,onSubmit:()=>{Y(c),C("")},onChange:C,onCancel:()=>{var e;null==(e=t.current)||e.abort()},loading:L,className:e.sender,allowSpeech:!0,actions:(t,n)=>{let{SendButton:s,LoadingButton:o,SpeechButton:a}=n.components;return(0,r.jsxs)(z.A,{gap:4,children:[(0,r.jsx)(a,{className:e.speechButton}),L?(0,r.jsx)(o,{type:"default"}):(0,r.jsx)(s,{type:"primary"})]})},placeholder:"Ask me anything about shopping..."})]});return(0,T.useEffect)(()=>{if((null==G?void 0:G.length)>0){var e;let t=G[G.length-1];(null==t||null==(e=t.message)?void 0:e.role)==="assistant"&&(null==t?void 0:t.status)==="success"&&(console.log("Message completed, resetting streaming state"),F(!1))}},[G]),(0,T.useEffect)(()=>{if(null==G?void 0:G.length){var e;s(e=>{let t={...e,[i]:G};return localStorage.setItem("chat_message_history",JSON.stringify(t)),t});let t=G.find(e=>{var t;return(null==(t=e.message)?void 0:t.role)==="user"});if(t&&(null==(e=t.message)?void 0:e.content)){let e=o.find(e=>e.key===i);if(e&&e.label.startsWith("Chat ")){let e=t.message.content,n=e.length>30?e.substring(0,30)+"...":e;a(e=>e.map(e=>e.key===i?{...e,label:n}:e))}}}},[G,i]),(0,T.useEffect)(()=>{localStorage.setItem("chat_conversations",JSON.stringify(o))},[o]),(0,T.useEffect)(()=>{localStorage.setItem("chat_current_conversation",i)},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(B.default,{}),(0,r.jsxs)("div",{className:e.layout,children:[Q,(0,r.jsxs)("div",{className:e.chat,children:[V,X]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[66,309,907,148,79,961,441,684,358],()=>t(68371)),_N_E=e.O()}]);