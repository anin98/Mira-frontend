(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{58733:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>H});var a=s(95155),r=s(11518),i=s.n(r),n=s(12115),o=s(19868),l=s(98696),d=s(90765);let c=e=>{let t=/\[QR_CODE_IMAGE:(.*?)\]/g.exec(e);if(t)return t[1].replace(/[\]\s]+$/,"").trim();let s=/\[([^\]]*(?:QR|qr|Scan|scan)[^\]]*)\]\((https?:\/\/[^)]+)\)/gi.exec(e);if(s){let e=s[2].replace(/[\]\s]+$/,"").trim();if(/\.(jpg|jpeg|png|gif|webp|svg)(\?[^)]*)?$/i.test(e)||e.includes("qrcode")||e.includes("qr"))return e}if(e.includes("Bkash QR Code")||e.includes("QR Code")||e.includes("this QR code")){let t=/(https?:\/\/[^\s)]+(?:qr|QR|jpg|jpeg|png|gif|webp)[^\s)]*)/gi.exec(e);if(t)return t[1].replace(/[\]\s]+$/,"").trim()}let a=/(https?:\/\/[^\s]+(?:qr|QR|qrcode)[^\s]*)/gi.exec(e);return a?a[1].replace(/[\]\s]+$/,"").trim():null},p=e=>null!==c(e),g=e=>{let t=e;if(t=(t=(t=(t=t.replace(/style="[^"]*"/g,"")).replace(/\[QR_CODE_IMAGE:(.*?)\]/g,(e,t)=>'<div style="margin: 16px 0; text-align: center;">\n        <button onclick="window.openPaymentImage && window.openPaymentImage(\''.concat(t,'\')" \n                style="background: linear-gradient(135deg, #1890ff, #722ed1); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;">\n          \uD83D\uDCF1 View Payment QR Code\n        </button>\n      </div>'))).replace(/\b(Click here|click here)\b(?:\s*\([^)]*scanning[^)]*\))?/gi,'<span style="color: #666; font-style: italic;">QR Code available in payment panel above</span>')).replace(/\[([^\]]*(?:QR|qr|Scan|scan)[^\]]*)\]\((https?:\/\/[^)]+)\)/gi,(e,t,s)=>{let a=s.replace(/[\]\s]+$/,"").trim();return/\.(jpg|jpeg|png|gif|webp|svg)(\?[^)]*)?$/i.test(a)||a.includes("qrcode")||a.includes("qr")?'<span style="color: #1890ff; font-weight: 600;">\uD83D\uDCF1 '.concat(t,'</span> <span style="color: #666; font-size: 12px;">(available in payment panel above)</span>'):'<a href="'.concat(a,'" target="_blank" rel="noopener noreferrer" style="color: #1890ff; text-decoration: none; font-weight: 500;">').concat(t,"</a>")}),e.includes("bKash")||e.includes("QR Code Option")||e.includes("this QR code")){let s=/(https?:\/\/[^\s)]+)/gi.exec(e);s&&s[1],t=t.replace(/(?:QR Code Option:|this QR code|Scan QR|QR Code)\s*:?\s*/gi,'<span style="color: #1890ff; font-weight: 600;">\uD83D\uDCF1 QR Code</span> <span style="color: #666; font-size: 12px;">(use payment panel above)</span> ')}t=t.replace(/\[([^\]]+)\]\((https?:\/\/[^)]+)\)/gi,(e,t,s)=>{let a=s.replace(/[\]\s]+$/,"").trim();return t.match(/QR|qr|Scan|scan/i)?e:'<a href="'.concat(a,'" target="_blank" rel="noopener noreferrer" style="color: #1890ff; text-decoration: none; font-weight: 500;">').concat(t,"</a>")});let s=RegExp("(?<![\"'>])(https?:\\/\\/[^\\s<>]+(?:qr|QR|qrcode)[^\\s<>\\]]*)","gi");return(t=t.replace(s,(e,t)=>(t.replace(/[\]\s]+$/,"").trim(),'<span style="color: #666; font-size: 12px; font-style: italic;">QR Code URL (use payment panel above to view)</span>'))).replace(/\*\*(.*?)\*\*/g,'<strong style="font-weight: 600;">$1</strong>').replace(/__(.*?)__/g,'<strong style="font-weight: 600;">$1</strong>').replace(/\*([^*\n]+)\*/g,"<em>$1</em>").replace(RegExp("(?<!https?:\\/\\/[^\\s]*)\\b_([^_\\s][^_\\n]*[^_\\s])_(?![^\\s]*\\.(jpg|jpeg|png|gif|webp|svg))","g"),"<em>$1</em>").replace(/\n/g,"<br>").replace(/^(\d+\.\s+)/gm,'<br><strong style="color: #1890ff;">$1</strong>').replace(/^[-*]\s+/gm,"<br>â€¢ ").replace(/^<br>/,"").replace(/(Send money to this number:|Amount:|Reference:|Transaction ID)/gi,'<strong style="color: #1890ff; font-weight: 600;">$1</strong>').replace(/(\d{11})/g,'<span style="background: #f0f8ff; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-weight: 600;">$1</span>').replace(/(\d+\s*taka)/gi,'<span style="background: #f6ffed; padding: 2px 6px; border-radius: 4px; font-weight: 600; color: #52c41a;">$1</span>').replace(/(Order ID \d+|TxID [A-Z0-9]+)/gi,'<span style="background: #fff7e6; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-weight: 600; color: #fa8c16;">$1</span>')};var f=s(49509);class x{async sendMessage(e,t,s,a,r){let i=[...t,{role:"user",content:e}],n={"Content-Type":"application/json"},o={session_id:s,company_id:this.COMPANY_ID_TO_TEST,messages:i};if(a){let e=localStorage.getItem("access_token");e?n.Authorization="Bearer ".concat(e):n.Authorization="Client-Key ".concat(this.PUBLIC_CLIENT_KEY)}else n.Authorization="Client-Key ".concat(this.PUBLIC_CLIENT_KEY);try{var l;let e=await fetch(this.API_ENDPOINT,{method:"POST",headers:n,body:JSON.stringify(o)});if(!e.ok){let t=await e.text();console.error("API Error Response:",t);let s="Server error: ".concat(e.status);try{let e=JSON.parse(t);if(e.detail)if(Array.isArray(e.detail)){let t=e.detail.map(e=>{var t;return"".concat((null==(t=e.loc)?void 0:t.join("."))||"field",": ").concat(e.msg)}).join(", ");s="Validation error: ".concat(t)}else s="Error: ".concat(e.detail);else e.message&&(s="Error: ".concat(e.message))}catch(a){s="Server error: ".concat(e.status," ").concat(t)}throw Error(s)}let t=null==(l=e.body)?void 0:l.getReader(),s=new TextDecoder,a="",i="";if(t){for(;;){let{done:e,value:n}=await t.read();if(e)break;let o=s.decode(n,{stream:!0}),l=(i+=o).split("\n");for(let e of(i=l.pop()||"",l))if(e.startsWith("data: "))try{let t=e.substring(6),s=JSON.parse(t);if("text"===s.type&&s.data){let e=s.data;for(let t=0;t<e.length;t++)a+=e[t],r(e[t]),await new Promise(e=>setTimeout(e,20))}}catch(s){let t=e.substring(6);for(let e=0;e<t.length;e++)a+=t[e],r(t[e]),await new Promise(e=>setTimeout(e,20))}else if(e.trim()&&!e.startsWith(":"))for(let t=0;t<e.length;t++)a+=e[t],r(e[t]),await new Promise(e=>setTimeout(e,20))}if(i.trim()&&i.startsWith("data: "))try{let e=i.substring(6),t=JSON.parse(e);if("text"===t.type&&t.data){let e=t.data;for(let t=0;t<e.length;t++)a+=e[t],r(e[t]),await new Promise(e=>setTimeout(e,20))}}catch(t){let e=i.substring(6);for(let t=0;t<e.length;t++)a+=e[t],r(e[t]),await new Promise(e=>setTimeout(e,20))}}if(!a){if((a=await e.text()).startsWith("data: "))try{let e=a.substring(6),t=JSON.parse(e);"text"===t.type&&t.data&&(a=t.data)}catch(e){}for(let e=0;e<a.length;e++)r(a[e]),await new Promise(e=>setTimeout(e,20))}return a&&""!==a.trim()||(a="I received your message but couldn't generate a response. Please try again."),a}catch(e){if(console.error("Error in sendMessage:",e),e instanceof Error){if(e.message.includes("Failed to fetch"))throw Error("Connection failed. Please check your internet connection and try again.");else if(e.message.includes("Validation error"))throw Error("API validation error: ".concat(e.message,". Please check the request format."))}throw e}}constructor(){this.PUBLIC_CLIENT_KEY=f.env.REACT_APP_PUBLIC_CLIENT_KEY||"15f1d1cb-b6a0-4133-9f5a-643a3affe291",this.COMPANY_ID_TO_TEST=1,this.API_ENDPOINT="https://mira-chat.grayscale-technologies.com/chat"}}var m=s(6874),y=s.n(m),h=s(58132),u=s(79336),b=s(12320),j=s(75032),w=s(85),k=s(33501),S=s(78505),A=s(92833),v=s(16243),C=s(96097);let{Title:R,Text:T}=h.A,I=e=>{let{isLoggedIn:t,hasError:s,typingState:r="",isTyping:i=!1}=e;return(0,a.jsx)(u.A,{style:{borderRadius:0,borderBottom:"1px solid #f0f0f0",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},bodyStyle:{padding:"16px 24px"},children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(b.A,{size:"middle",children:[(0,a.jsx)(y(),{href:"/",style:{cursor:"pointer",display:"flex"},children:(0,a.jsx)(j.A,{size:40,icon:i?(0,a.jsx)(k.A,{spin:!0}):void 0,src:i?void 0:"/mira-ai.png",style:{background:i?"linear-gradient(135deg, #52c41a, #73d13d)":"transparent",boxShadow:"0 2px 8px rgba(24, 144, 255, 0.3)",transition:"all 0.3s ease",cursor:"pointer",flexShrink:0,width:"40px",height:"40px",overflow:"hidden"}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(y(),{href:"/",style:{textDecoration:"none"},children:(0,a.jsx)(R,{level:4,style:{margin:0,color:"#1f2937",cursor:"pointer",transition:"color 0.2s"},className:"hover:text-blue-600",children:"MIRA AI"})}),i&&r?(0,a.jsx)(T,{style:{fontSize:"12px",color:"#52c41a",fontWeight:500,animation:"pulse 2s infinite"},children:r}):(0,a.jsx)(T,{type:"secondary",style:{fontSize:"12px"},children:"Your intelligent sales assistant"})]})]}),(0,a.jsxs)(b.A,{size:"large",children:[(0,a.jsxs)(b.A,{size:"small",children:[(0,a.jsx)(w.A,{color:s?"#ff4d4f":"#52c41a",text:(0,a.jsx)(T,{style:{fontSize:"12px",fontWeight:500},children:s?"Disconnected":"Connected"})}),s?(0,a.jsx)(S.A,{style:{color:"#ff4d4f"}}):(0,a.jsx)(A.A,{style:{color:"#52c41a"}})]}),(0,a.jsxs)(b.A,{size:"small",children:[(0,a.jsx)(w.A,{color:t?"#1890ff":"#d9d9d9",text:(0,a.jsx)(T,{style:{fontSize:"12px",fontWeight:500},children:t?"Logged In":"Guest"})}),t?(0,a.jsx)(v.A,{style:{color:"#1890ff"}}):(0,a.jsx)(C.A,{style:{color:"#d9d9d9"}})]})]})]})})};var P=s(37974),_=s(50274),z=s(87344),E=s(98790);let{Text:D}=h.A,Q=e=>{let{date:t}=e,[s,r]=(0,n.useState)("");return(0,n.useEffect)(()=>{r(t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}))},[t]),(0,a.jsx)(D,{type:"secondary",style:{fontSize:"11px",fontFamily:"monospace"},children:s})},N=e=>{let{message:t,formatMessage:s,storedQRUrl:r="",paymentCompleted:i=!1,isThinking:n=!1}=e,o=t.displayedText||t.text||"";if(!o&&!t.isStreaming)return null;let l=o||(t.isStreaming?"...":"No message content"),c="user"===t.sender,p=l.includes("bKash")||l.includes("QR Code")||l.includes("Scan")||l.includes("this QR code")||l.includes("Send money to"),g=(e=>{let t=/(https?:\/\/[^\s]+(?:qr|QR|qrcode)[^\s]*)/gi.exec(e);return t?t[1]:null})(l)||r;return(0,a.jsx)("div",{style:{display:"flex",justifyContent:c?"flex-end":"flex-start",marginBottom:16},children:(0,a.jsxs)("div",{style:{maxWidth:"75%",display:"flex",flexDirection:c?"row-reverse":"row",alignItems:"flex-start",gap:8},children:[(0,a.jsx)(j.A,{size:32,icon:c?(0,a.jsx)(_.A,{}):(0,a.jsx)(z.A,{}),style:{backgroundColor:c?"#1890ff":"#52c41a",flexShrink:0}}),(0,a.jsxs)(u.A,{size:"small",style:{backgroundColor:c?"#1890ff":"#ffffff",border:c?"none":"1px solid #f0f0f0",borderRadius:16,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",position:"relative"},bodyStyle:{padding:"12px 16px"},children:[p&&!c&&(0,a.jsx)("div",{style:{marginBottom:8},children:i?(0,a.jsx)(P.A,{icon:(0,a.jsx)(d.A,{}),color:"success",style:{fontWeight:500},children:"Payment Completed"}):g&&(0,a.jsx)(P.A,{icon:(0,a.jsx)(E.A,{}),color:"processing",style:{fontWeight:500},children:"Payment Required"})}),(0,a.jsx)("div",{style:{color:c?"#ffffff":"#000000",fontSize:"14px",lineHeight:"1.6",wordBreak:"break-word"},dangerouslySetInnerHTML:{__html:s(l)+(t.isStreaming&&o?'<span style="animation: blink 1s infinite; margin-left: 4px;">|</span>':"")}}),p&&!c&&g&&!i&&!l.includes("<button")&&(0,a.jsx)("div",{style:{marginTop:12,textAlign:"center",borderTop:"1px solid #f0f0f0",paddingTop:12}}),p&&!c&&i&&(0,a.jsx)("div",{style:{marginTop:12,textAlign:"center",borderTop:"1px solid #f0f0f0",paddingTop:12},children:(0,a.jsxs)("div",{style:{background:"#f6ffed",padding:"8px 12px",borderRadius:"6px",border:"1px solid #b7eb8f",color:"#52c41a",fontWeight:600,fontSize:"12px"},children:[(0,a.jsx)(d.A,{style:{marginRight:4}}),"Payment Completed Successfully"]})}),(0,a.jsx)("div",{style:{marginTop:8,textAlign:c?"right":"left",opacity:.7},children:(0,a.jsx)(Q,{date:t.timestamp})})]})]})})};var O=s(95108),L=s(99842),M=s(54160);let B=e=>{let{inputMessage:t,setInputMessage:s,onSendMessage:r,isTyping:i,error:n,typingState:o}=e;return(0,a.jsx)(u.A,{style:{borderRadius:0,borderTop:"1px solid #f0f0f0",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)",boxShadow:"0 -2px 8px rgba(0,0,0,0.06)"},bodyStyle:{padding:"16px 24px"},children:(0,a.jsxs)(b.A,{direction:"vertical",style:{width:"100%"},size:"middle",children:[n&&(0,a.jsx)(O.A,{message:n,type:"error",showIcon:!0,closable:!0,style:{borderRadius:"8px"}}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px",alignItems:"flex-end"},children:[(0,a.jsx)(L.A,{value:t,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),r())},placeholder:"What would you like to buy today?",disabled:i,size:"large",style:{borderRadius:"12px",border:"2px solid #f0f0f0",fontSize:"14px",padding:"12px 16px",height:"auto",minHeight:"48px"},suffix:i&&(0,a.jsx)(k.A,{style:{color:"#1890ff"}})}),(0,a.jsx)(l.Ay,{type:"primary",icon:(0,a.jsx)(M.A,{}),onClick:r,loading:i,disabled:i||!t.trim(),size:"large"})]}),i&&(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#666",fontSize:"12px"},children:[(0,a.jsx)(k.A,{}),(0,a.jsx)("span",{children:"Mira is typing..."})]})]})})};var W=s(26186),$=s(16467),q=s(94600),U=s(58587),F=s(16913),K=s(70129);let{Text:Y,Title:J}=h.A,V=e=>{let{imageUrl:t,open:s,onClose:r,onPaymentComplete:i,showPaymentComplete:o=!1}=e,[c,p]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),[x,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&t&&(p(!1),f(!1),m(!1))},[s,t]);let y=async()=>{try{let e=await fetch(t),s=await e.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download="payment-qr-code.jpg",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}catch(e){console.error("Download failed:",e),window.open(t,"_blank")}},h=async()=>{try{await navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),2e3)}catch(e){console.error("Copy failed:",e)}};return(0,a.jsx)(W.A,{title:(0,a.jsxs)(b.A,{children:[(0,a.jsx)(j.A,{size:"small",icon:(0,a.jsx)(E.A,{}),style:{backgroundColor:"#1890ff"}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(J,{level:5,style:{margin:0},children:"Payment QR Code"}),(0,a.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:"Scan to complete your payment"})]})]}),open:s,onCancel:r,footer:null,centered:!0,width:450,styles:{body:{padding:"24px"}},children:g?(0,a.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px"},children:[(0,a.jsx)(j.A,{size:64,icon:(0,a.jsx)(U.A,{}),style:{backgroundColor:"#ff4d4f",marginBottom:16}}),(0,a.jsx)(J,{level:4,type:"danger",children:"Failed to load QR code"}),(0,a.jsx)(Y,{type:"secondary",style:{display:"block",marginBottom:16},children:"There was an error loading the QR code image"}),(0,a.jsx)(l.Ay,{type:"link",onClick:()=>window.open(t,"_blank"),children:"Open in new tab"})]}):(0,a.jsxs)("div",{style:{textAlign:"center"},children:[!c&&(0,a.jsxs)("div",{style:{padding:"40px 20px"},children:[(0,a.jsx)($.A,{size:"large"}),(0,a.jsx)(J,{level:4,style:{marginTop:16,color:"#1890ff"},children:"Loading QR code..."})]}),(0,a.jsxs)("div",{style:{display:c?"block":"none"},children:[(0,a.jsx)(u.A,{style:{display:"inline-block",marginBottom:24,border:"2px solid #f0f0f0",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},bodyStyle:{padding:"16px"},children:(0,a.jsx)("img",{src:t,alt:"Payment QR Code",style:{width:280,height:280,objectFit:"contain",borderRadius:"8px"},onLoad:()=>p(!0),onError:()=>f(!0)})}),(0,a.jsxs)("div",{style:{marginBottom:24},children:[(0,a.jsxs)(Y,{type:"secondary",style:{display:"block",marginBottom:8,fontSize:"14px"},children:["\uD83D\uDCF1 ",(0,a.jsx)("strong",{children:"Scan this QR code"})," with your mobile banking app"]}),(0,a.jsx)(Y,{type:"secondary",style:{fontSize:"12px"},children:"bKash, Rocket, Nagad, or any QR-enabled payment app"})]}),(0,a.jsx)(q.A,{}),(0,a.jsxs)(b.A,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,a.jsxs)(b.A,{size:"middle",wrap:!0,style:{justifyContent:"center"},children:[(0,a.jsx)(l.Ay,{type:"primary",icon:(0,a.jsx)(F.A,{}),onClick:y,style:{borderRadius:"8px",background:"linear-gradient(135deg, #1890ff, #722ed1)",border:"none"},children:"Download"}),(0,a.jsx)(l.Ay,{icon:(0,a.jsx)(K.A,{}),onClick:h,style:{borderRadius:"8px"},children:x?"Copied!":"Copy Link"}),(0,a.jsx)(l.Ay,{icon:(0,a.jsx)(E.A,{}),onClick:()=>window.open(t,"_blank"),style:{borderRadius:"8px"},children:"Open Full Size"})]}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q.A,{style:{margin:"16px 0"}}),(0,a.jsxs)("div",{style:{background:"#f6ffed",padding:"16px",borderRadius:"8px",border:"1px solid #b7eb8f"},children:[(0,a.jsx)(Y,{style:{display:"block",marginBottom:12,fontWeight:500},children:"âœ… Completed your payment?"}),(0,a.jsx)(l.Ay,{type:"primary",size:"large",icon:(0,a.jsx)(d.A,{}),onClick:()=>{i&&i(),r()},style:{width:"100%",background:"#52c41a",border:"none",borderRadius:"8px",fontWeight:600,fontSize:"16px",height:"48px"},children:"Mark Payment as Complete"}),(0,a.jsx)(Y,{type:"secondary",style:{fontSize:"12px",marginTop:8,display:"block"},children:"Click this after successfully completing the payment"})]})]})]})]})]})})},H=()=>{let[e,t]=(0,n.useState)([{id:"1",text:"Hello, this is Mira. I will assist you on your purchase today. What would you like to buy?",sender:"bot",timestamp:new Date,isStreaming:!0,displayedText:""}]),[s,r]=(0,n.useState)(""),[f,m]=(0,n.useState)(!1),[y,h]=(0,n.useState)([]),[u,b]=(0,n.useState)(""),[j,w]=(0,n.useState)("1"),[k,S]=(0,n.useState)(""),[A,v]=(0,n.useState)(!1),[C]=(0,n.useState)(()=>crypto.randomUUID()),R=(0,n.useRef)(null),[T,P]=(0,n.useState)(""),[_,z]=(0,n.useState)(!1),[E,D]=(0,n.useState)(!1),[Q,O]=(0,n.useState)(!1),[L,M]=(0,n.useState)(""),[W,$]=(0,n.useState)("idle"),[q,U]=(0,n.useState)(0),F=new x,K=["Thinking..."],Y=["\uD83E\uDD14 Mira is thinking"];(0,n.useEffect)(()=>{let e=localStorage.getItem("access_token");console.log("Token is",e),v(!!e)},[]),(0,n.useEffect)(()=>{var e;null==(e=R.current)||e.scrollIntoView({behavior:"smooth"})},[e]),(0,n.useEffect)(()=>{let e;return f&&j&&(e=setInterval(()=>{U(e=>(e+1)%K.length),t(e=>e.map(e=>e.id===j&&e.isStreaming?{...e,text:K[q],displayedText:K[q]}:e))},1500)),()=>{e&&clearInterval(e)}},[f,j,q]),(0,n.useEffect)(()=>{let e,t=0;return f?($("thinking"),e=setInterval(()=>{M(Y[t]),t=(t+1)%Y.length},2e3)):($("idle"),M("")),()=>{e&&clearInterval(e)}},[f]),(0,n.useEffect)(()=>{if(!j)return;let s=e.find(e=>e.id===j&&e.isStreaming);if(!s||!s.text)return;let a=s.text;!K.includes(a)&&a&&s.displayedText&&a===s.displayedText&&(t(e=>e.map(e=>e.id===j?{...e,isStreaming:!1}:e)),w(null),$("idle"))},[e,j]),(0,n.useEffect)(()=>{let t=e.filter(e=>"bot"===e.sender&&!e.isStreaming).pop();if(t&&!Q){let e=c(t.text);e&&e!==T&&(P(e),z(!1),D(!0),setTimeout(()=>{S(e),O(!0),o.Ay.info("Payment QR code opened automatically")},1e3))}},[e,Q,T]),(0,n.useEffect)(()=>{let e=window;return e.openPaymentImage=e=>{S(e||T)},e.markPaymentComplete=()=>{z(!0),P(""),D(!1),O(!1),S(""),o.Ay.success("Payment marked as completed!")},()=>{delete e.openPaymentImage,delete e.markPaymentComplete}},[T]);let J=async()=>{if(!s.trim()||f)return;let e={id:Date.now().toString(),text:s,sender:"user",timestamp:new Date};t(t=>[...t,e]),r(""),m(!0),b(""),$("thinking");let a=(Date.now()+1).toString(),i={id:a,text:K[0],sender:"bot",timestamp:new Date,isStreaming:!0,displayedText:K[0]};t(e=>[...e,i]),w(a),U(0);try{let e=(Date.now()+2).toString(),r="";$("generating");let i=await F.sendMessage(s,y,C,A,s=>{r+=s,$("typing"),t(t=>{if(t.some(t=>t.id===e))return t.map(t=>t.id===e?{...t,text:r,displayedText:r,hasPaymentImage:p(r)}:t);{let s=t.filter(e=>e.id!==a),i={id:e,text:r,sender:"bot",timestamp:new Date,isStreaming:!0,displayedText:r,hasPaymentImage:p(r)};return[...s,i]}})}),n=[...y,{role:"user",content:s},{role:"assistant",content:i}];h(n),t(t=>t.map(t=>t.id===e?{...t,text:i,displayedText:i,isStreaming:!1,hasPaymentImage:p(i)}:t)),w(null),$("idle")}catch(s){t(e=>e.filter(e=>e.id!==a));let e={id:(Date.now()+3).toString(),text:s instanceof Error?s.message:"An unexpected error occurred. Please try again.",sender:"bot",timestamp:new Date};t(t=>[...t,e]),b(s instanceof Error?s.message:"An unexpected error occurred."),w(null),$("idle"),o.Ay.error(s instanceof Error?s.message:"An unexpected error occurred.")}finally{m(!1),$("idle")}},H=()=>{z(!0),P(""),D(!1),O(!1),S(""),r("I have completed the payment. Please confirm my order."),o.Ay.success("Payment marked as completed! Confirming with Mira..."),setTimeout(()=>{J()},1e3)};return(0,a.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)"},className:"jsx-5b5ca08c8f25f5b1",children:[(0,a.jsx)(I,{isLoggedIn:A,hasError:!!u,typingState:L,isTyping:f}),E&&T&&!_&&(0,a.jsx)("div",{style:{background:"linear-gradient(135deg, #e2136e, #ff6b9d)",color:"white",padding:"12px 20px",textAlign:"center",fontSize:"14px",fontWeight:600,borderBottom:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(226, 19, 110, 0.2)"},className:"jsx-5b5ca08c8f25f5b1",children:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"12px"},className:"jsx-5b5ca08c8f25f5b1",children:[(0,a.jsx)("span",{className:"jsx-5b5ca08c8f25f5b1",children:"\uD83D\uDCB3 Payment QR Code Available"}),(0,a.jsx)(l.Ay,{size:"small",onClick:()=>S(T),style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",color:"white",fontWeight:600,borderRadius:"6px"},children:"View QR Code"}),(0,a.jsx)(l.Ay,{size:"small",icon:(0,a.jsx)(d.A,{}),onClick:H,style:{background:"rgba(255,255,255,0.9)",border:"none",color:"#e2136e",fontWeight:600,borderRadius:"6px"},children:"Mark as Paid"})]})}),(0,a.jsxs)("div",{style:{flex:1,padding:"20px",overflowY:"auto",background:"transparent"},className:"jsx-5b5ca08c8f25f5b1",children:[e.map(e=>(0,a.jsx)(N,{message:e,formatMessage:g,storedQRUrl:T,paymentCompleted:_,isThinking:K.includes(e.text)},e.id)),(0,a.jsx)("div",{ref:R,className:"jsx-5b5ca08c8f25f5b1"})]}),(0,a.jsx)(B,{inputMessage:s,setInputMessage:r,onSendMessage:J,isTyping:f,error:u,typingState:L}),(0,a.jsx)(V,{imageUrl:k,open:!!k,onClose:()=>S(""),onPaymentComplete:H,showPaymentComplete:!!T&&!_}),(0,a.jsx)(i(),{id:"5b5ca08c8f25f5b1",children:'@-webkit-keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}@-moz-keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}@-o-keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}@keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}@-webkit-keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}@-moz-keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}@-o-keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}@-webkit-keyframes dots{0%,20%{color:rgba(0,0,0,.4);text-shadow:.25em 0 0 rgba(0,0,0,.2),.5em 0 0 rgba(0,0,0,.2)}40%{color:rgba(0,0,0,1);text-shadow:.25em 0 0 rgba(0,0,0,.4),.5em 0 0 rgba(0,0,0,.2)}60%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,.4)}80%,100%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,1)}}@-moz-keyframes dots{0%,20%{color:rgba(0,0,0,.4);text-shadow:.25em 0 0 rgba(0,0,0,.2),.5em 0 0 rgba(0,0,0,.2)}40%{color:rgba(0,0,0,1);text-shadow:.25em 0 0 rgba(0,0,0,.4),.5em 0 0 rgba(0,0,0,.2)}60%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,.4)}80%,100%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,1)}}@-o-keyframes dots{0%,20%{color:rgba(0,0,0,.4);text-shadow:.25em 0 0 rgba(0,0,0,.2),.5em 0 0 rgba(0,0,0,.2)}40%{color:rgba(0,0,0,1);text-shadow:.25em 0 0 rgba(0,0,0,.4),.5em 0 0 rgba(0,0,0,.2)}60%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,.4)}80%,100%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,1)}}@keyframes dots{0%,20%{color:rgba(0,0,0,.4);text-shadow:.25em 0 0 rgba(0,0,0,.2),.5em 0 0 rgba(0,0,0,.2)}40%{color:rgba(0,0,0,1);text-shadow:.25em 0 0 rgba(0,0,0,.4),.5em 0 0 rgba(0,0,0,.2)}60%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,.4)}80%,100%{text-shadow:.25em 0 0 rgba(0,0,0,1),.5em 0 0 rgba(0,0,0,1)}}.thinking-indicator.jsx-5b5ca08c8f25f5b1{-webkit-animation:pulse 2s infinite;-moz-animation:pulse 2s infinite;-o-animation:pulse 2s infinite;animation:pulse 2s infinite}.dots.jsx-5b5ca08c8f25f5b1::after{content:"...";-webkit-animation:dots 1.5s infinite;-moz-animation:dots 1.5s infinite;-o-animation:dots 1.5s infinite;animation:dots 1.5s infinite}'})]})}},68371:(e,t,s)=>{Promise.resolve().then(s.bind(s,58733))}},e=>{var t=t=>e(e.s=t);e.O(0,[448,808,108,345,997,441,684,358],()=>t(68371)),_N_E=e.O()}]);